<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ConfirmaÃ§Ã£o de PresenÃ§a - Pedro DÃ´mini</title>

<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: #f7f2e8;
  min-height: 100vh;
  margin: 0;
  overflow-x: hidden;
}

.folhas { position: fixed; inset: 0; pointer-events: none; z-index: 1; }
.folha { position: absolute; width: 28px; opacity: 0.6; animation: cair linear infinite; }
@keyframes cair {
  from { transform: translateY(-50px) rotate(0deg); }
  to { transform: translateY(110vh) rotate(360deg); }
}

.container {
  position: relative;
  z-index: 2;
  background: #ffffff;
  padding: 30px;
  border-radius: 18px;
  max-width: 440px;
  margin: 40px auto;
  box-shadow: 0 15px 35px rgba(0,0,0,0.15);
  border: 4px solid #2f7d32;
}

.header-img {
  width: 100%;
  max-width: 340px;
  display: block;
  margin: 0 auto 20px;
}

h2 { text-align: center; color: #2f7d32; }

label {
  font-weight: 600;
  margin-top: 18px;
  display: block;
  color: #4e342e;
}

input, textarea, select {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #cfcfcf;
  font-size: 15px;
}

textarea { resize: vertical; }

button {
  margin-top: 25px;
  width: 100%;
  padding: 15px;
  background-color: #2f7d32;
  color: white;
  font-size: 17px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}
button:hover { background-color: #256428; }
button:disabled { opacity: .6; cursor: not-allowed; }

/* LOADING */
#loading {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.96);
  z-index: 9999;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 20px;
}

/* FALLBACK */
#waFallback {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.98);
  z-index: 99999;
  padding: 20px;
}
#waFallback .card {
  max-width: 520px;
  margin: 40px auto;
  background: #fff;
  border-radius: 16px;
  padding: 18px;
  box-shadow: 0 10px 30px rgba(0,0,0,.12);
}
#waFallback textarea {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #cfcfcf;
}
#waFallback .row {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}
#waFallback .btn {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}
#waFallback .btn-primary { background: #2f7d32; color: #fff; }
#waFallback .btn-outline { background: #fff; border: 1px solid #ccc; }
</style>
</head>

<body>

<div id="loading">
  <h2>â³ Aguarde</h2>
  <p>Registrando sua confirmaÃ§Ã£o ğŸ’š</p>
</div>

<div id="waFallback">
  <div class="card">
    <h3>Quase lÃ¡ âœ…</h3>
    <p>Se o WhatsApp nÃ£o abriu automaticamente, toque no botÃ£o abaixo:</p>
    <textarea id="waMsg" rows="7"></textarea>
    <div class="row">
      <a id="btnOpenWa" class="btn btn-primary" href="#" target="_blank">Abrir WhatsApp</a>
      <button id="btnCopyWa" class="btn btn-outline">Copiar mensagem</button>
    </div>
  </div>
</div>

<div class="folhas" id="folhas"></div>

<div class="container">

<img src="https://office-net-ofc.github.io/confirmacao-de-presenca/imagens/aergergerg.PNG"
class="header-img">

<h2>ğŸŒ¿ ConfirmaÃ§Ã£o de PresenÃ§a</h2>

<label>Qual Ã© o seu nome?</label>
<input type="text" id="nome" placeholder="Digite seu nome completo">

<label>Quantas pessoas contando com vocÃª irÃ£o?</label>
<select id="quantidade">
  <option value="">Qtd</option>
  <option>1</option><option>2</option><option>3</option>
  <option>4</option><option>5</option><option>6</option>
</select>

<label>Quem irÃ¡ com vocÃª?</label>
<textarea
  id="pessoas"
  placeholder="Ex: Maria Silva, JoÃ£o Silva (5 anos)">
</textarea>

<label>Confirma presenÃ§a?</label>
<select id="status">
  <option value="Confirmado">âœ… Sim</option>
  <option value="NÃ£o poderÃ¡ comparecer">âŒ NÃ£o</option>
</select>

<button id="btnEnviar">Enviar confirmaÃ§Ã£o ğŸ’š</button>
</div>

<script>
const WHATSAPP_PHONE = "559885699508";
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzJiVAymgiZuoWMaq1-U8ZD1n6m7cdF841LP8aYmB0LysRNbZfmbOPvKlnNftgiG30hfQ/exec";

const nome = document.getElementById("nome");
const quantidade = document.getElementById("quantidade");
const pessoas = document.getElementById("pessoas");
const status = document.getElementById("status");
const btnEnviar = document.getElementById("btnEnviar");

const loading = document.getElementById("loading");
const waFallback = document.getElementById("waFallback");
const waMsg = document.getElementById("waMsg");
const btnOpenWa = document.getElementById("btnOpenWa");
const btnCopyWa = document.getElementById("btnCopyWa");

function abrirWhatsAppComFallback(mensagem) {
  const text = encodeURIComponent(mensagem);
  const android = /Android/i.test(navigator.userAgent || "");
  const waLink = `https://wa.me/${WHATSAPP_PHONE}?text=${text}`;

  if (android) {
    window.location.href =
      `intent://send?phone=${WHATSAPP_PHONE}&text=${text}#Intent;scheme=whatsapp;package=com.whatsapp;end`;
    setTimeout(() => {
      window.location.href = `whatsapp://send?phone=${WHATSAPP_PHONE}&text=${text}`;
    }, 600);
    setTimeout(() => {
      mostrarFallback(mensagem, waLink);
    }, 1200);
  } else {
    window.location.href = waLink;
    setTimeout(() => {
      mostrarFallback(mensagem, waLink);
    }, 1200);
  }
}

function mostrarFallback(mensagem, link) {
  waMsg.value = mensagem;
  btnOpenWa.href = link;
  btnCopyWa.onclick = () => {
    navigator.clipboard.writeText(mensagem);
    btnCopyWa.innerText = "Copiado âœ…";
  };
  waFallback.style.display = "block";
}

btnEnviar.onclick = async () => {
  if (!nome.value || !quantidade.value) {
    alert("Preencha nome e quantidade");
    return;
  }

  loading.style.display = "flex";

  const mensagem =
`ğŸŒ¿ *CONFIRMAÃ‡ÃƒO DE PRESENÃ‡A* ğŸŒ¿
ğŸ‰ AniversÃ¡rio de 1 ano do Pedro DÃ´mini

ğŸ‘¤ Nome: ${nome.value}
ğŸ‘¥ Quantidade: ${quantidade.value}
ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Pessoas: ${pessoas.value || "NÃ£o informado"}
ğŸ“Œ Status: ${status.value}`;

  const formData = new FormData();
  formData.append("nome", nome.value);
  formData.append("quantidade", quantidade.value);
  formData.append("pessoas", pessoas.value);
  formData.append("status", status.value);

  await fetch(GOOGLE_SCRIPT_URL, { method: "POST", body: formData });

  loading.style.display = "none";
  abrirWhatsAppComFallback(mensagem);
};
</script>

</body>
</html>
